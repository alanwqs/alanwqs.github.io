<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器知识 | 前端小时</title>
    <meta name="description" content="">
    <link rel="icon" href="/images/photo.jpg">
  <link rel="manifest" href="/images/photo.jpg">
  <link rel="apple-touch-icon" href="/images/photo.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.6aaa91c1.css" as="style"><link rel="preload" href="/assets/js/app.6c60143e.js" as="script"><link rel="preload" href="/assets/js/21.76e4f6fa.js" as="script"><link rel="prefetch" href="/assets/js/10.6b10a528.js"><link rel="prefetch" href="/assets/js/11.d7afebf9.js"><link rel="prefetch" href="/assets/js/12.f91b76fa.js"><link rel="prefetch" href="/assets/js/13.ee8d44a0.js"><link rel="prefetch" href="/assets/js/14.5fd9bab5.js"><link rel="prefetch" href="/assets/js/15.71185e7c.js"><link rel="prefetch" href="/assets/js/16.ae6001aa.js"><link rel="prefetch" href="/assets/js/17.79fc5361.js"><link rel="prefetch" href="/assets/js/18.42f30bb4.js"><link rel="prefetch" href="/assets/js/19.ef32d8a4.js"><link rel="prefetch" href="/assets/js/2.858e80da.js"><link rel="prefetch" href="/assets/js/20.5a98ceda.js"><link rel="prefetch" href="/assets/js/22.3f95dcd3.js"><link rel="prefetch" href="/assets/js/23.ba4d25bc.js"><link rel="prefetch" href="/assets/js/24.6a597996.js"><link rel="prefetch" href="/assets/js/25.227fb7ef.js"><link rel="prefetch" href="/assets/js/26.71946d04.js"><link rel="prefetch" href="/assets/js/27.db9dae04.js"><link rel="prefetch" href="/assets/js/28.ed68d8d4.js"><link rel="prefetch" href="/assets/js/29.63bc6416.js"><link rel="prefetch" href="/assets/js/3.3ede1f01.js"><link rel="prefetch" href="/assets/js/30.a9d05c1f.js"><link rel="prefetch" href="/assets/js/31.48f62c42.js"><link rel="prefetch" href="/assets/js/32.27c58484.js"><link rel="prefetch" href="/assets/js/33.f712075e.js"><link rel="prefetch" href="/assets/js/34.46e288c9.js"><link rel="prefetch" href="/assets/js/35.970c7f61.js"><link rel="prefetch" href="/assets/js/36.3644495c.js"><link rel="prefetch" href="/assets/js/37.0331be5a.js"><link rel="prefetch" href="/assets/js/38.64813422.js"><link rel="prefetch" href="/assets/js/39.f702b220.js"><link rel="prefetch" href="/assets/js/4.d3babcf5.js"><link rel="prefetch" href="/assets/js/40.0ddc56cc.js"><link rel="prefetch" href="/assets/js/41.46b314f4.js"><link rel="prefetch" href="/assets/js/42.7c392dca.js"><link rel="prefetch" href="/assets/js/43.87c578ae.js"><link rel="prefetch" href="/assets/js/44.4af6e740.js"><link rel="prefetch" href="/assets/js/45.e7e0dc1e.js"><link rel="prefetch" href="/assets/js/46.8cf9aafb.js"><link rel="prefetch" href="/assets/js/47.4fdbccab.js"><link rel="prefetch" href="/assets/js/48.17e8c14f.js"><link rel="prefetch" href="/assets/js/49.3fefb3c7.js"><link rel="prefetch" href="/assets/js/5.9485e149.js"><link rel="prefetch" href="/assets/js/50.eef5a0ce.js"><link rel="prefetch" href="/assets/js/51.d13fd75c.js"><link rel="prefetch" href="/assets/js/52.369ab3aa.js"><link rel="prefetch" href="/assets/js/53.cea9ac87.js"><link rel="prefetch" href="/assets/js/54.f9bc320e.js"><link rel="prefetch" href="/assets/js/55.7ab13cf8.js"><link rel="prefetch" href="/assets/js/56.16470a4a.js"><link rel="prefetch" href="/assets/js/57.d925d174.js"><link rel="prefetch" href="/assets/js/58.80cf022a.js"><link rel="prefetch" href="/assets/js/59.ec44b198.js"><link rel="prefetch" href="/assets/js/6.f5b22e2d.js"><link rel="prefetch" href="/assets/js/60.0880c9ba.js"><link rel="prefetch" href="/assets/js/61.991dc017.js"><link rel="prefetch" href="/assets/js/62.4ff6f265.js"><link rel="prefetch" href="/assets/js/63.02ad01a3.js"><link rel="prefetch" href="/assets/js/64.35e5afd7.js"><link rel="prefetch" href="/assets/js/65.f8b832c1.js"><link rel="prefetch" href="/assets/js/66.31422d32.js"><link rel="prefetch" href="/assets/js/67.b7251c18.js"><link rel="prefetch" href="/assets/js/68.0d2e42a1.js"><link rel="prefetch" href="/assets/js/69.34fe27a6.js"><link rel="prefetch" href="/assets/js/7.9bf19d03.js"><link rel="prefetch" href="/assets/js/8.f79eb03f.js"><link rel="prefetch" href="/assets/js/9.90611952.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6aaa91c1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端小时</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法题库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/leetcodeTop.html" class="nav-link">LeetCode TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/byte-dance.html" class="nav-link">字节 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/methods.html" class="nav-link">LeetCode 解题方法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/tencentTop100.html" class="nav-link">腾讯 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/aliTop100.html" class="nav-link">阿里 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/front-end.html" class="nav-link">前端手写代码</a></li><li class="dropdown-item"><!----> <a href="/algorithm/class.html" class="nav-link">跟着Carl学算法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/tencent.html" class="nav-link">腾讯精选练习 50 题</a></li><li class="dropdown-item"><!----> <a href="/algorithm/2020.html" class="nav-link">2020 名企高频面试题</a></li><li class="dropdown-item"><!----> <a href="/algorithm/middle.html" class="nav-link">中级算法</a></li></ul></div></div><div class="nav-item"><a href="http://blog.alanwu.website/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  旧版博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法题库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/leetcodeTop.html" class="nav-link">LeetCode TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/byte-dance.html" class="nav-link">字节 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/methods.html" class="nav-link">LeetCode 解题方法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/tencentTop100.html" class="nav-link">腾讯 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/aliTop100.html" class="nav-link">阿里 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/front-end.html" class="nav-link">前端手写代码</a></li><li class="dropdown-item"><!----> <a href="/algorithm/class.html" class="nav-link">跟着Carl学算法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/tencent.html" class="nav-link">腾讯精选练习 50 题</a></li><li class="dropdown-item"><!----> <a href="/algorithm/2020.html" class="nav-link">2020 名企高频面试题</a></li><li class="dropdown-item"><!----> <a href="/algorithm/middle.html" class="nav-link">中级算法</a></li></ul></div></div><div class="nav-item"><a href="http://blog.alanwu.website/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  旧版博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>浏览器知识</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/browser/#_1、两个页面间的通信" class="sidebar-link">1、两个页面间的通信</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_2、首屏加载优化" class="sidebar-link">2、首屏加载优化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_3、浏览器缓存" class="sidebar-link">3、浏览器缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/browser/#缓存位置" class="sidebar-link">缓存位置</a></li><li class="sidebar-sub-header"><a href="/browser/#缓存策略" class="sidebar-link">缓存策略</a></li></ul></li><li><a href="/browser/#_4、css-的渲染层合成是什么-浏览器如何创建新的渲染层" class="sidebar-link">4、css 的渲染层合成是什么 浏览器如何创建新的渲染层</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_5、常见的浏览器内核" class="sidebar-link">5、常见的浏览器内核</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_6、浏览器的主要组成部分是什么" class="sidebar-link">6、浏览器的主要组成部分是什么</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_7、为什么javascript是单线程的，与异步冲突吗" class="sidebar-link">7、为什么JavaScript是单线程的，与异步冲突吗</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_8、css加载会造成阻塞吗" class="sidebar-link">8、CSS加载会造成阻塞吗</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_9、为什么js会阻塞页面加载" class="sidebar-link">9、为什么JS会阻塞页面加载</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_10、defer-和-async-的区别" class="sidebar-link">10、defer 和 async 的区别</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_11、为什么css动画比javascript高效" class="sidebar-link">11、为什么CSS动画比JavaScript高效</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_12、requestanimationframe" class="sidebar-link">12、requestAnimationFrame</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_13、localstorage-和-sessionstorage" class="sidebar-link">13、localStorage 和 sessionStorage</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_14、跨域，同源策略，跨域解决方案" class="sidebar-link">14、跨域，同源策略，跨域解决方案</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_15、谈一谈你对xss攻击理解" class="sidebar-link">15、谈一谈你对XSS攻击理解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_16、csrf攻击" class="sidebar-link">16、CSRF攻击</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_17、304状态码" class="sidebar-link">17、304状态码</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/#_18、chorme-打开一个-tab，会有多少个进程" class="sidebar-link">18、chorme 打开一个 tab，会有多少个进程</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="_1、两个页面间的通信"><a href="#_1、两个页面间的通信" class="header-anchor">#</a> 1、两个页面间的通信</h2> <ul><li><h4 id="websocket"><a href="#websocket" class="header-anchor">#</a> <font color="Tomato">WebSocket</font></h4></li></ul> <p>（1）WebSocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议</p> <p>（2）需要服务器来支持</p> <p>（3）比较成熟稳定当然是 <a href="https://github.com/socketio/socket.io" target="_blank" rel="noopener noreferrer">socket.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/websockets/ws" target="_blank" rel="noopener noreferrer">ws<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. 也还有轻量级的<a href="https://github.com/ClusterWS/ClusterWS" target="_blank" rel="noopener noreferrer">ClusterWS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li><h5 id="定时器-客户端存储"><a href="#定时器-客户端存储" class="header-anchor">#</a> <font color="Tomato">定时器 + 客户端存储</font></h5></li></ul> <p>（1）定时器：setTimeout/setInterval/requestAnimationFrame
（2）客户端存储： cookie/localStorage/sessionStorage/indexDB/chrome的FileSystem</p> <ul><li><h5 id="postmessage"><a href="#postmessage" class="header-anchor">#</a> <font color="Tomato">postMessage</font></h5></li></ul> <p>（1）需要两个窗体建立起联系，window.open/window.opener/iframe</p> <p>（2）获取被打开窗口的句柄，就可直接操作</p> <ul><li><h5 id="storageevent"><a href="#storageevent" class="header-anchor">#</a> <font color="Tomato">StorageEvent</font></h5></li></ul> <p>（1）利用localStorage事件可以进行通信</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// page 1</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> <span class="token string">'消息'</span>，
    from<span class="token operator">:</span> <span class="token string">'Page 1'</span><span class="token punctuation">,</span>
    date<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// page 2</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;storage&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>key<span class="token punctuation">,</span> e<span class="token punctuation">.</span>newValue<span class="token punctuation">,</span> e<span class="token punctuation">.</span>oldValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>e：StorageEvent</p> <p>![image-20210827071413324](/Users/wuqingshi/Library/Application Support/typora-user-images/image-20210827071413324.png)</p> <p>![image-20210827071633649](/Users/wuqingshi/Library/Application Support/typora-user-images/image-20210827071633649.png)</p> <ul><li><h5 id="broadcast-channel"><a href="#broadcast-channel" class="header-anchor">#</a> <font color="Tomato">Broadcast Channel</font></h5></li></ul> <p>（1）适用于多窗口通信，Service Woker也可以使用</p> <p>（2）创建BroadcastChannel， 然后监听事件，渠道名称一致就可以</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// page 1</span>
<span class="token keyword">var</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastChannel</span><span class="token punctuation">(</span><span class="token string">&quot;channel-BroadcastChannel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Hello, BroadcastChannel!'</span><span class="token punctuation">)</span>

<span class="token comment">// page 2</span>
<span class="token keyword">var</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastChannel</span><span class="token punctuation">(</span><span class="token string">&quot;channel-BroadcastChannel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><h5 id="sharedworker"><a href="#sharedworker" class="header-anchor">#</a> <font color="Tomato">SharedWorker</font></h5></li></ul> <p>（1）这是Web Worker之后出来的共享的Worker，不通页面可以共享这个Worker</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 简单例子</span>
<span class="token function-variable function">onconnect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> port <span class="token operator">=</span> e<span class="token punctuation">.</span>ports<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> workerResult <span class="token operator">=</span> <span class="token string">'Result: '</span> <span class="token operator">+</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> e<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>workerResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 改造例子</span>
<span class="token keyword">var</span> portList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function-variable function">onconnect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> port <span class="token operator">=</span> e<span class="token punctuation">.</span>ports<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">ensurePorts</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
  port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token function">disptach</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  port<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 如果自己的port不在portList里面，就push进去</span>
<span class="token keyword">function</span> <span class="token function">ensurePorts</span><span class="token punctuation">(</span><span class="token parameter">port</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>portList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    portList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 发布给不是自己窗口的消息消息</span>
<span class="token keyword">function</span> <span class="token function">disptach</span><span class="token punctuation">(</span><span class="token parameter">selfPort<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  portList
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">port</span> <span class="token operator">=&gt;</span> selfPort <span class="token operator">!==</span> port<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">port</span> <span class="token operator">=&gt;</span> port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="_2、首屏加载优化"><a href="#_2、首屏加载优化" class="header-anchor">#</a> 2、首屏加载优化</h2> <p>（1）确定加载缓慢原因，webpack-bundle-analyzer，一般都是一些三方库进行全部的引入</p> <p>（2）分离打包第三方的库，可采用externals进行配置</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>externals<span class="token operator">:</span> <span class="token punctuation">{</span>
    vue<span class="token operator">:</span> 'Vue'<span class="token punctuation">,</span>
    vuex<span class="token operator">:</span> 'Vuex'<span class="token punctuation">,</span>
    'vue-router'<span class="token operator">:</span> 'VueRouter'<span class="token punctuation">,</span>
    axios<span class="token operator">:</span> 'axios'<span class="token punctuation">,</span>
    'element-ui'<span class="token operator">:</span> 'ELEMENT'
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>（3）vue-router使用懒加载</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/Login'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Login'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span> <span class="token comment">/* webpackChunkName: &quot;Login&quot; */</span>  <span class="token string">'@/view/Login'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>（4）减少使用图片，可使用icon</p> <p>（5）服务端使用nginx开启gzip压缩</p> <p>（6）webpack优化</p> <ul><li>压缩JS，使用 uglifyjs-webpack-plugin</li> <li>压缩CSS，使用optimize-css-assets-webpack-plugin，使用mini-xss-extract-plugin提取CSS 到单独的文件</li></ul> <p>（7）代码层面优化</p> <ul><li><p>合理使用v-if/v-show</p></li> <li><p>合理使用监听器watch</p></li> <li><p>v-for使用key优化</p></li> <li><p>定时器的销毁</p></li></ul> <p><font color="Tomato"><strong>总结：</strong></font></p> <ul><li>external</li> <li>gzip</li> <li>cdn</li> <li>削图片</li> <li>懒加载</li></ul> <h2 id="_3、浏览器缓存"><a href="#_3、浏览器缓存" class="header-anchor">#</a> 3、浏览器缓存</h2> <p>前端的工作与各大浏览器的关系紧密相连，尤其是对于性能这一块的联系及其重要。在用户体验上来看，一个请求的时间超过3秒，那么就会失去这个用户，所以利用缓存来提升性能以及用户体验都是很重要的。</p> <p>前端对于任一个网络请求来说，可以将请求分为三个阶段。网络请求，后端处理，浏览器响应。缓存可以优化我们的第一步和第三步，一个网络请求做到性能最优，就必须提升三者各自的性能，避免短板效应。</p> <p>接下来我会从缓存位置，缓存策略来结合具体场景分析浏览器缓存机制。</p> <p><img src="navigatorCache/1.webp" alt></p> <h3 id="缓存位置"><a href="#缓存位置" class="header-anchor">#</a> 缓存位置</h3> <div class="tip custom-block"><p class="custom-block-title">谷歌官方</p> <p>通过网络获取内容既速度缓慢又开销巨大。较大的响应需要在客户端与服务器之间进行多次往返通信，这会延迟浏览器获得和处理内容的时间，还会增加访问者的流量费用。因此，缓存并重复利用之前获取的资源的能力成为性能优化的一个关键方面。</p></div> <p>浏览器缓存并非是一个“总体”概念，其实它也是有先后顺序的。总的来说分为以下4个方面。</p> <ol><li>Memory Cache</li> <li>Service Worker Cache</li> <li>Disk Cache</li> <li>Push Cache</li></ol> <p><img src="navigatorCache/1.jpg" alt></p> <p>从这张图中我们可以清楚地看到浏览器缓存的具体位置，其中的网络请求都会有不同位置的缓存。考虑到HTTP缓存是最主要、最有代表性的缓存策略，也是每一位前端工程师都应该深刻理解并掌握的知识。</p> <h5 id="memory-cache"><a href="#memory-cache" class="header-anchor">#</a> <strong>Memory Cache</strong></h5> <p>Memory Cacha是指内存中的缓存。它是浏览器优先去命中的一种缓存，也是响应速度最快的一种缓存。但是它的缺点是缓存时间短，关闭tab页面缓存将不复存在，它与浏览器渲染进程紧密联系。</p> <p>那么哪一些文件会被放到这一缓存里面呢？其实这没有官方的说明，由于浏览器的内存非常有限，浏览器并不会把所有文件都缓存在此处。一般来说会缓存一些体积不大的js或者css文件。</p> <h5 id="service-worker-cache"><a href="#service-worker-cache" class="header-anchor">#</a> <strong>Service Worker Cache</strong></h5> <p>Service Worker 是一种独立于主线程之外的javascript线程。它脱离于浏览器窗体，因此无法直接访问DOM元素。所以这一个独立的线程能够在不干扰主线程的情况下来提升性能。Service Worker 的缓存与浏览器内建的其他缓存机制不一样，它可以让我们自由缓存哪一些文件、如何匹配缓存等，且缓存具有持续性。</p> <p>实现该缓存一般分为3个步骤：首先注册Service Worker ，然后监听install事件就可以缓存我们想要的文件。用户下次访问可以通过拦截请求的方式来获取缓存数据。若没有则会重新获取数据，然后再进行缓存。</p> <p>Service Worker 可以用来实现离线缓存、消息推送以及网络代理等功能。那我们如何使用这种缓存呢？</p> <p>注册：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/test.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
   <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注册成功'</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;注册失败&quot;</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>监听事件：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>
<span class="token comment">// Service Worker会监听 install事件，我们在其对应的回调里可以实现初始化的逻辑  </span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    <span class="token comment">// 考虑到缓存也需要更新，open内传入的参数为缓存的版本号</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'test-v1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token comment">// 此处传入指定的需缓存的文件名</span>
        <span class="token string">'/test.html'</span><span class="token punctuation">,</span>
        <span class="token string">'/test.css'</span><span class="token punctuation">,</span>
        <span class="token string">'/test.js'</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Service Worker会监听所有的网络请求，网络请求的产生触发的是fetch事件，我们可以在其对应的监听函数中实现对请求的拦截，进而判断是否有对应到该请求的缓存，实现从Service Worker中取到缓存的目的</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    <span class="token comment">// 尝试匹配该请求对应的缓存值</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果匹配到了，调用Server Worker缓存</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 如果没匹配到，向服务端发起这个资源请求</span>
      <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response <span class="token operator">||</span> response<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 请求成功的话，将请求缓存起来。</span>
        caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'test-v1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>PS：大家注意 Server Worker 对协议是有要求的，必须以 https 协议为前提。</p> <h5 id="disk-cache"><a href="#disk-cache" class="header-anchor">#</a> <strong>Disk Cache</strong></h5> <p>Disk Cache也就是硬盘缓存。这种缓存的缓存位置在电脑硬盘上，什么文件都可以缓存，就是读取速度慢。所有缓存中，它的覆盖面是最广的，会根据HTTP Header中的字段判断哪一些资源需要缓存，哪些可以不请求直接使用，哪一些已过期需要重新请求。</p> <p>浏览器通常会把哪些文件放进缓存呢?</p> <ul><li>大体积文件</li> <li>系统内存使用率高</li></ul> <h5 id="push-cache"><a href="#push-cache" class="header-anchor">#</a> <strong>Push Cache</strong></h5> <p>Push Cache又名推送缓存，是HTTP/2中的内容，只有以上三种缓存未正确命中，它才会使用。仅存在于会话阶段（session），结束就会释放，缓存时间短。</p> <p>由于国内用的比较少，网上查找后总结几个结论：</p> <ul><li>Push Cache 是一种存在于会话阶段的缓存，当 session 终止时，缓存也随之释放。</li> <li>不同的页面只要共享了同一个 HTTP2 连接，那么它们就可以共享同一个 Push Cache</li> <li>Push Cache 是缓存的最后一道防线。浏览器均未命中以上的情况下才会去询问 Push Cache。</li> <li>Push Cache中的缓存只能被使用一次。</li></ul> <p><img src="navigatorCache/2.webp" alt></p> <h3 id="缓存策略"><a href="#缓存策略" class="header-anchor">#</a> 缓存策略</h3> <p>浏览器缓存策略通常分为两种：<strong>强缓存</strong>和<strong>协商缓存</strong>。</p> <p>一次HTTP请求示意图如下所示。浏览器第一次发起请求，事先询问浏览器是否有缓存。没有则向服务器进行请求，然后结果进行缓存。</p> <p><img src="navigatorCache/1.png" alt></p> <h5 id="强缓存"><a href="#强缓存" class="header-anchor">#</a> <strong>强缓存</strong></h5> <p>强缓存是利用 http 头中的 Expires 和 Cache-Control 两个字段来控制的。强缓存中，当请求再次发出时，浏览器会根据其中的 expires 和 cache-control 判断目标资源是否“命中”强缓存，若命中则直接从缓存中获取资源，不会再与服务端发生通信。</p> <p>expires 是一个时间戳，二次请求我们试图向服务器请求资源，浏览器就会先对比本地时间和 expires 的时间戳，如果本地时间小于 expires 设定的过期时间，那么就直接去缓存中取这个资源。</p> <p>它最大的问题在于对“本地时间”有很大的依赖。如果服务端和客户端的时间设置可能不同，或者我直接手动去把客户端的时间改掉，那么 expires 将无法达到我们的预期。所以我们有第二种方法Cache-Control。</p> <p>Cache-Control 是一个时间长度，我们通过 <code>max-age</code> 来控制资源的有效期，它意味着该资源在时间长度以内都是有效的，完美地规避了时间戳带来的潜在问题。它的优先级更高，当两者同时出现的时候我们以Cache-Control为准。</p> <p>Cache-Control有如下字段比较常见。</p> <h6 id="s-maxage-和-max-age"><a href="#s-maxage-和-max-age" class="header-anchor">#</a> <strong>s-maxage 和 max-age</strong></h6> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>cache<span class="token operator">-</span>control<span class="token operator">:</span> max<span class="token operator">-</span>age<span class="token operator">=</span><span class="token number">3600</span><span class="token punctuation">,</span> s<span class="token operator">-</span>maxage<span class="token operator">=</span><span class="token number">31536000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>s-maxage的优先级比max-age高。s-maxage是代理服务器的缓存时间。客户端中我们以max-age为准。</p> <h6 id="public-与-private"><a href="#public-与-private" class="header-anchor">#</a> <strong>public 与 private</strong></h6> <p>public 与 private 是针对资源是否能够被代理服务缓存而存在的一组对立概念。如果我们为资源设置了 public，那么它既可以被浏览器缓存，也可以被代理服务器缓存；如果我们设置了 private，则该资源只能被浏览器缓存。private 为默认值。</p> <h6 id="no-store-与-no-cache"><a href="#no-store-与-no-cache" class="header-anchor">#</a> <strong>no-store 与 no-cache</strong></h6> <p>no-cache 绕开了浏览器：我们为资源设置了 no-cache 后，每一次发起请求都不会再去询问浏览器的缓存情况，而是直接向服务端去确认该资源是否过期（协商缓存）。</p> <p>no-store 比较绝情，顾名思义就是不使用任何缓存策略。在 no-cache 的基础上，它连服务端的缓存确认也绕开了，只允许你直接向服务端发送请求、并下载完整的响应。</p> <h5 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> <strong>协商缓存</strong></h5> <p>协商缓存依赖于服务端与浏览器之间的通信。</p> <p>协商缓存机制下，浏览器需要向服务器去询问缓存的相关信息，进而判断是重新发起请求、下载完整的响应，还是从本地获取缓存的资源。</p> <p>如果服务端提示缓存资源未改动（Not Modified），资源会被重定向到浏览器缓存，对应状态码是304。</p> <p><img src="navigatorCache/2.png" alt></p> <p>协商缓存有两个字段：Last-Modified 和 Etag</p> <p>Last-Modified 是一个时间戳，如果我们启用了协商缓存，它会在首次请求时随着 Response Headers 返回：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Last-Modified: Fri, <span class="token number">25</span> Oct <span class="token number">2018</span> 06:35:57 GMT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>随后我们每次请求时，会带上一个叫 If-Modified-Since 的时间戳字段，它的值正是上一次 response 返回给它的 last-modified 值：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Last<span class="token operator">-</span>Modified<span class="token operator">:</span> Fri<span class="token punctuation">,</span> <span class="token number">25</span> Oct <span class="token number">2018</span> <span class="token number">06</span><span class="token operator">:</span><span class="token number">35</span><span class="token operator">:</span><span class="token number">57</span> <span class="token constant">GMT</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>服务器接收到这个时间戳后，会比对该时间戳和资源在服务器上的最后修改时间是否一致，从而判断资源是否发生了变化。如果发生了变化，就会返回一个完整的响应内容，并在 Response Headers 中添加新的 Last-Modified 值；否则，返回如上图的 304 响应，Response Headers 不会再添加 Last-Modified 字段。</p> <p><strong>缺点与弊端：</strong></p> <ul><li>手动改动服务器内容，即使没有修改内容，但服务器也认为是新的内容。进而引发一次完整的响应——不该重新请求的时候，也会重新请求。</li> <li>修改文件速度过快（比如花了 100ms 完成了改动），由于 If-Modified-Since 只能检查到以秒为最小计量单位的时间差，所以它是感知不到这个改动的——该重新请求的时候，反而没有重新请求了。</li></ul> <p>为了解决问题，Etag出现了。Etag 是由服务器为每个资源生成的唯一的标识字符串，这个标识字符串是基于文件内容编码的，只要文件内容不同，它们对应的 Etag 就是不同的，反之亦然。因此 Etag 能够精准地感知文件的变化。</p> <p>Etag 和 Last-Modified 类似，当首次请求时，我们会在响应头里获取到一个最初的标识符字符串，它可以是这样的：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ETag: W/&quot;2a3b-1602480f459&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么下一次请求时，请求头里就会带上一个值相同的、名为 if-None-Match 的字符串供服务端比对了：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>If-None-Match: W/&quot;2a3b-1602480f459&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Etag 的生成过程需要服务器额外付出开销，会影响服务端的性能，这是它的弊端。因此启用 Etag 需要我们审时度势。Etag的优先级比Last-Modified高。</p> <p><img src="navigatorCache/3.webp" alt></p> <p><img src="navigatorCache/2.gif" alt></p> <h2 id="_4、css-的渲染层合成是什么-浏览器如何创建新的渲染层"><a href="#_4、css-的渲染层合成是什么-浏览器如何创建新的渲染层" class="header-anchor">#</a> 4、css 的渲染层合成是什么 浏览器如何创建新的渲染层</h2> <p>在 DOM 树中每个节点都会对应一个渲染对象（RenderObject），当它们的渲染对象处于相同的坐标空间（z 轴空间）时，就会形成一个 RenderLayers，也就是渲染层。渲染层将保证页面元素以正确的顺序堆叠，这时候就会出现层合成（composite），从而正确处理透明元素和重叠元素的显示。对于有位置重叠的元素的页面，这个过程尤其重要，因为一旦图层的合并顺序出错，将会导致元素显示异常</p> <p>浏览器如何创建新的渲染层？</p> <ul><li><p>根元素 document</p></li> <li><p>有明确的定位属性（relative、fixed、sticky、absolute）</p></li> <li><p>opacity &lt; 1</p></li> <li><p>有 CSS fliter 属性</p></li> <li><p>有 CSS mask 属性</p></li> <li><p>有 CSS mix-blend-mode 属性且值不为 normal</p></li> <li><p>有 CSS transform 属性且值不为 none</p></li> <li><p>backface-visibility 属性为 hidden</p></li> <li><p>有 CSS reflection 属性</p></li> <li><p>有 CSS column-count 属性且值不为 auto 或者有 CSS column-width 属性且值不为 auto</p></li> <li><p>当前有对于 opacity、transform、fliter、backdrop-filter 应用动画</p></li> <li><p>overflow 不为 visible</p></li></ul> <p><img src="https://juejin.cn/post/6844903966573068301" alt="关于合成层与渲染层的关系"></p> <h2 id="_5、常见的浏览器内核"><a href="#_5、常见的浏览器内核" class="header-anchor">#</a> 5、常见的浏览器内核</h2> <table><thead><tr><th>浏览器/RunTime</th> <th>内核（渲染引擎）</th> <th>JavaScript 引擎</th></tr></thead> <tbody><tr><td>Chrome</td> <td>webkit-&gt;blink</td> <td>V8</td></tr> <tr><td>FireFox</td> <td>Gecko</td> <td>SpiderMonkey</td></tr> <tr><td>Safari</td> <td>Webkit</td> <td>JavaScriptCore</td></tr> <tr><td>Edge</td> <td>EdgeHTML</td> <td>Chakra(for JavaScript)</td></tr> <tr><td>IE</td> <td>Trident</td> <td>JScript（IE3.0-IE8.0）</td></tr> <tr><td>Opera</td> <td>Presto-&gt;blink</td> <td>Linear A（4.0-6.1）/ Linear B（7.0-9.2）/ Futhark（9.5-10.2）/ Carakan（10.5-）</td></tr> <tr><td>Node.js</td> <td>-</td> <td>V8</td></tr></tbody></table> <h2 id="_6、浏览器的主要组成部分是什么"><a href="#_6、浏览器的主要组成部分是什么" class="header-anchor">#</a> 6、浏览器的主要组成部分是什么</h2> <p><code>用户界面</code> - 包括地址栏、前进/后退按钮、书签菜单等。</p> <p><code>浏览器引擎</code> - 在用户界面和呈现引擎之间传送指令。</p> <p><code>呈现引擎</code> - 负责显示请求的内容。如果请求的内容是 HTML，它就负责解析 HTML 和 CSS 内容，并将解析后的内容显示在屏幕上。</p> <p><code>网络</code> - 用于网络调用，比如 HTTP 请求。</p> <p><code>用户界面后端</code> -用于绘制基本的窗口小部件，比如组合框和窗口。</p> <p><code>JavaScript 解释器</code>- 用于解析和执行 JavaScript 代码。</p> <p><code>数据存储</code> - 这是持久层。浏览器需要在硬盘上保存各种数据，例如 Cookie。新的 HTML 规范 (HTML5) 定义了“网络数据库”，这是一个完整（但是轻便）的浏览器内数据库。</p> <p>值得注意的是，和大多数浏览器不同，Chrome 浏览器的每个标签页都分别对应一个呈现引擎实例。每个标签页都是一个独立的进程。</p> <h2 id="_7、为什么javascript是单线程的，与异步冲突吗"><a href="#_7、为什么javascript是单线程的，与异步冲突吗" class="header-anchor">#</a> 7、为什么JavaScript是单线程的，与异步冲突吗</h2> <p>补充：JS中其实是没有线程概念的，所谓的单线程也只是相对于多线程而言。JS的设计初衷就没有考虑这些，针对JS这种不具备并行任务处理的特性，我们称之为“单线程”。</p> <p>JS的单线程是指一个浏览器进程中只有一个JS的执行线程，同一时刻内只会有一段代码在执行</p> <p>举个通俗例子，假设JS支持多线程操作的话，JS可以操作DOM，那么一个线程在删除DOM，另外一个线程就在获取DOM数据，这样子明显不合理，这算是证明之一</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'second'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>打印结果就是首先是很多个first,然后再是second</p> <p>异步机制是浏览器的两个或以上常驻线程共同完成的，举个例子，比如异步请求由两个常驻线程，JS执行线程和事件触发线程共同完成的</p> <ul><li><p>JS执行线程发起异步请求（浏览器会开启一个HTTP请求线程来执行请求，这时JS的任务完成，继续执行线程队列中剩下任务）</p></li> <li><p>然后在未来的某一时刻事件触发线程监视到之前的发起的HTTP请求已完成，它就会把完成事件插入到JS执行队列的尾部等待JS处理</p></li></ul> <p>再比如定时器触发(settimeout和setinterval) 是由<code>浏览器的定时器线程</code>执行的定时计数，然后在定时时间把定时处理函数的执行请求插入到JS执行队列的尾端（所以用这两个函数的时候，实际的执行时间是大于或等于指定时间的，不保证能准确定时的）</p> <p>所以这么说，JS单线程与异步更多是浏览器行为，之间不冲突</p> <h2 id="_8、css加载会造成阻塞吗"><a href="#_8、css加载会造成阻塞吗" class="header-anchor">#</a> 8、CSS加载会造成阻塞吗</h2> <p><code>结论</code></p> <ul><li><p>CSS不会阻塞DOM解析，但会阻塞DOM渲染</p></li> <li><p>CSS会阻塞JS执行，并不会阻塞JS文件下载</p></li></ul> <p><code>CSSOM作用</code></p> <ul><li><p>第一个是提供给 JavaScript 操作样式表的能力</p></li> <li><p>第二个是为布局树的合成提供基础的样式信息</p></li> <li><p>这个 CSSOM 体现在 DOM 中就是document.styleSheets。</p></li></ul> <p>由之前讲过的浏览器渲染流程我们可以看出：</p> <p>DOM 和 CSSOM通常是并行构建的，所以<strong>CSS 加载不会阻塞 DOM 的解析</strong></p> <p>然而由于<code>Render Tree</code> 是依赖<code>DOM Tree</code>和 <code>CSSOM Tree</code>的，所以它必须等到两者都加载完毕后，完成相应的构建，才开始渲染，因此，<strong>CSS加载会阻塞DOM渲染</strong></p> <p>由于 JavaScript 是可操纵 DOM 和 css 样式 的,如果在修改这些元素属性同时渲染界面（即 JavaScript 线程和 UI 线程同时运行）,那么渲染线程前后获得的元素数据就可能不一致了。</p> <p>因此为了防止渲染出现不可预期的结果,浏览器设置 「GUI 渲染线程与 JavaScript 引擎为互斥」的关系。</p> <p>有个需要注意的点就是：</p> <p>「有时候JS需要等到CSS的下载，这是为什么呢？」</p> <p>仔细思考一下，其实这样做是有道理的，如果脚本的内容是获取元素的样式，宽高等CSS控制的属性，浏览器是需要计算的，也就是依赖于CSS。浏览器也无法感知脚本内容到底是什么，为避免样式获取，因而只好等前面所有的样式下载完后，再执行JS。</p> <p>JS文件下载和CSS文件下载是并行的，有时候CSS文件很大，所以JS需要等待。</p> <p>因此,样式表会在后面的 js 执行前先加载执行完毕,所以 <strong>css 会阻塞后面 js 的执行</strong></p> <h2 id="_9、为什么js会阻塞页面加载"><a href="#_9、为什么js会阻塞页面加载" class="header-anchor">#</a> 9、为什么JS会阻塞页面加载</h2> <ul><li><p>由于 JavaScript 是可操纵 DOM 的,如果在修改这些元素属性同时渲染界面（即 JavaScript 线程和 UI 线程同时运行）,那么渲染线程前后获得的元素数据就可能不一致了。</p></li> <li><p>因此为了防止渲染出现不可预期的结果,浏览器设置 「GUI 渲染线程与 JavaScript 引擎为互斥」的关系。</p></li> <li><p>当 JavaScript 引擎执行时 GUI 线程会被挂起,GUI 更新会被保存在一个队列中等到引擎线程空闲时立即被执行。</p></li> <li><p>当浏览器在执行 JavaScript 程序的时候,GUI 渲染线程会被保存在一个队列中,直到 JS 程序执行完成,才会接着执行。</p></li> <li><p>因此如果 JS 执行的时间过长,这样就会造成页面的渲染不连贯,导致页面渲染加载阻塞的感觉。</p></li></ul> <p>另外，如果 JavaScript 文件中没有操作 DOM 相关代码，就可以将该 JavaScript 脚本设置为异步加载，通过 async 或 defer 来标记代码</p> <h2 id="_10、defer-和-async-的区别"><a href="#_10、defer-和-async-的区别" class="header-anchor">#</a> 10、defer 和 async 的区别</h2> <ul><li><p>DOMContentLoaded事件触发时：仅当DOM解析完成后，不包括样式表，图片等资源。</p></li> <li><p>onload 事件触发时,页面上所有的 DOM,样式表,脚本,图片等资源已经加载完毕。</p></li></ul> <p><img src="/images/browser/defer.png" alt></p> <h2 id="_11、为什么css动画比javascript高效"><a href="#_11、为什么css动画比javascript高效" class="header-anchor">#</a> 11、为什么CSS动画比JavaScript高效</h2> <p><code>CSS 动画</code></p> <ul><li><p>浏览器可以对动画进行优化</p></li> <li><p>帧速不好的浏览器，CSS3 可以自然降级兼容</p></li> <li><p>代码简单，调优方向固定</p></li></ul> <p><code>JS动画</code></p> <p>JS 动画是逐帧动画，在时间帧上绘制内容，一帧一帧的，所以他的可再造性很高，几乎可以完成任何你想要的动画形式。但是由于逐帧动画的内容不一样，会增加制作的负担，占用比较大的资源空间</p> <ul><li><p>细腻的动画</p></li> <li><p>可控性高</p></li> <li><p>炫酷高级的动画</p></li></ul> <p>为什么？</p> <ul><li><p>从实现动画的复杂度来看，CSS 动画大多数都是补间动画，而 JS 动画是逐帧动画。当然这里我们不谈论实现的效果</p></li> <li><p>编码的高效，采用 JS 去实现的动画，无论多简单的动画，都需要去控制整个过程，当然你可能会说可以采用一些库来解决这些问题，但是这些库的实际运行可能要比原生实现的效率要低的多</p></li> <li><p>性能的高效，在我们前面讲到了回流和重绘，如果我们要操作一个元素向右移动，我们可能需要控制 dom.style.left 属性，每次来改变元素的位置，而结合我们所说的，几何属性的改变必然会引起回流，回流必然引起重绘，可想而知如果我们采用 JS 来实现动画，这个代价有多大，这会造成浏览器在不断的计算页面，从而导致浏览器内存堆积。同时由于 JavaScript 运行在浏览器的主线程中，主线程中还有其他的重要任务在运行，因而可能会受到干扰导致线程阻塞，从而丢帧</p></li></ul> <p>CSS 的动画是运行在合成线程中的，不会阻塞主线程，并且在合成线程中完成的动作不会触发回流和重绘</p> <ul><li>JS 动画运行在 CPU，而 CSS 动画运行在 GPU，CSS动画的渲染成本小，并且它的执行效率高于 JavaScript 动画</li></ul> <h2 id="_12、requestanimationframe"><a href="#_12、requestanimationframe" class="header-anchor">#</a> 12、requestAnimationFrame</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>window.requestAnimationFrame() 方法告诉浏览器您希望执行动画并请求浏览器在下一次重绘之前调用指定的函数来更新动画。</p> <p>该方法使用一个回调函数作为参数，这个回调函数会在浏览器重绘之前调用</p></div> <p>当我们调用这个函数的时候，我们告诉它需要做两件事：</p> <ul><li><p>我们需要新的一帧</p></li> <li><p>当你渲染新的一帧时需要执行我传给你的回调函数</p></li></ul> <p>rAF(requestAnimationFrame) 最大的优势是「由系统来决定回调函数的执行时机」</p> <p>具体一点讲就是，系统每次绘制之前会主动调用 rAF 中的回调函数，如果系统绘制率是 60Hz，那么回调函数就每16.7ms 被执行一次，如果绘制频率是75Hz，那么这个间隔时间就变成了 1000/75=13.3ms</p> <p>与setTimeout动画对比的话，有以下几点优势</p> <ul><li><p>当页面隐藏或者最小化时，setTimeout仍然在后台执行动画，此时页面不可见或者是不可用状态，动画刷新没有意义，而言浪费CPU。</p></li> <li><p>rAF不一样，当页面处理未激活的状态时，该页面的屏幕绘制任务也会被系统暂停，因此跟着系统步伐走的rAF也会停止渲染，当页面被激活时，动画就从上次停留的地方继续执行，有效节省了 CPU 开销。</p></li></ul> <p><strong>什么时候调用呢</strong></p> <p>规范中似乎是这么去定义的：</p> <ul><li><p>在重新渲染前调用</p></li> <li><p>很可能在宏任务之后不去调用</p></li></ul> <p>这样子分析的话，似乎很合理嘛，为什么要在重新渲染前去调用呢？因为rAF作为官方推荐的一种做流畅动画所应该使用的API，做动画不可避免的去操作DOM，而如果是在渲染后去修改DOM的话，那就只能等到下一轮渲染机会的时候才能去绘制出来了，这样子似乎不合理</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>rAF在浏览器决定渲染之前给你最后一个机会去改变 DOM 属性，然后很快在接下来的绘制中帮你呈现出来，所以这是做流畅动画的不二选择</p></div> <h2 id="_13、localstorage-和-sessionstorage"><a href="#_13、localstorage-和-sessionstorage" class="header-anchor">#</a> 13、localStorage 和 sessionStorage</h2> <table><thead><tr><th>分类</th> <th>生命周期</th> <th>存储容量</th> <th>存储位置</th></tr></thead> <tbody><tr><td>cookie</td> <td>默认保存在内存中，随浏览器关闭失效（如果设置过期时间，在到过期时间后失效）</td> <td>4KB</td> <td>保存在客户端，每次请求时都会带上</td></tr> <tr><td>localStorage</td> <td>理论上永久有效的，除非主动清除。</td> <td>4.98MB（不同浏览器情况不同，safari 2.49M）</td> <td>保存在客户端，不与服务端交互。节省网络流量</td></tr> <tr><td>sessionStorage</td> <td>仅在当前网页会话下有效，关闭页面或浏览器后会被清除</td> <td>4.98MB（部分浏览器没有限制）</td> <td>保存在客户端，不与服务端交互。节省网络流量</td></tr> <tr><td>indexedDB</td> <td>除非被清理，否则一直存在</td> <td>无限</td> <td>保存在客户端，不与服务端交互。节省网络流量</td></tr></tbody></table> <p><code>使用方式</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 存储</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;TianTianUp&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TianTianUp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 取值</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> info <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>应用场景</code></p> <ul><li><p>localStorage 适合持久化缓存数据，比如页面的默认偏好配置，如官网的logo，存储Base64格式的图片资源等；</p></li> <li><p>sessionStorage 适合一次性临时数据保存，存储本次浏览信息记录，这样子页面关闭的话，就不需要这些记录了，还有对表单信息进行维护，这样子页面刷新的话，也不会让表单信息丢失</p></li></ul> <h2 id="_14、跨域，同源策略，跨域解决方案"><a href="#_14、跨域，同源策略，跨域解决方案" class="header-anchor">#</a> 14、跨域，同源策略，跨域解决方案</h2> <p><code>跨域</code></p> <p>跨域，是指浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对JavaScript实施的安全限制。</p> <p><code>同源策略</code></p> <p>同源策略是一个安全策略。所谓的同源,指的是协议,域名,端口相同。</p> <ul><li><p>Cookie、LocalStorage 和 IndexDB 无法读取</p></li> <li><p>DOM 和 JS 对象无法获取</p></li> <li><p>Ajax请求发送不出去</p></li></ul> <p><code>解决方案</code></p> <p><strong>jsonp跨域</strong></p> <p>利用script标签没有跨域限制的漏洞，网页可以拿到从其他来源产生动态JSON数据，当然了JSONP请求一定要对方的服务器做支持才可以。</p> <p>兼容性比较好，可用于解决主流浏览器的跨域数据访问的问题。缺点就是仅支持get请求，具有局限性，不安全，可能会受到XSS攻击</p> <p>原理：</p> <ul><li><p>创建script标签</p></li> <li><p>设置script标签的src属性，以问号传递参数，设置好回调函数callback名称</p></li> <li><p>插入html文本中</p></li> <li><p>调用回调函数，res参数就是获取的数据</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://www.baidu.cn/login?username=TianTianUp&amp;callback=callback'</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>跨域资源共享 CORS</strong></p> <p>「CORS 需要浏览器和后端同时支持。IE 8 和 9 需要通过 XDomainRequest 来实现」。</p> <p>「浏览器会自动进行 CORS 通信，实现 CORS 通信的关键是后端。只要后端实现了 CORS，就实现了跨域。」服务端设置 Access-Control-Allow-Origin 就可以开启 CORS。 该属性表示哪些域名可以访问资源，如果设置通配符则表示所有网站都可以访问资源。</p> <p>请求分为「简单请求」和「非简单请求」，所以我们的了解这两种情况</p> <p>(1)简单请求</p> <p>条件1：使用下列方法之一：</p> <ul><li>GET</li> <li>HEAD</li> <li>POST</li></ul> <p>条件2：Content-Type 的值仅限于下列三者之一</p> <ul><li>text/plain</li> <li>multipart/form-data</li> <li>application/x-www-form-urlencoded</li></ul> <p>(2)复杂请求</p> <p>不符合以上条件的请求就肯定是复杂请求了。 复杂请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为&quot;预检&quot;请求,该请求是 option 方法的，通过该请求来知道服务端是否允许跨域请求</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//server2.js</span>
<span class="token keyword">let</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> whitList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://localhost:3000'</span><span class="token punctuation">]</span> <span class="token comment">//设置白名单</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> origin <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>origin
  <span class="token keyword">if</span> <span class="token punctuation">(</span>whitList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置哪个源可以访问我</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> origin<span class="token punctuation">)</span>
    <span class="token comment">// 允许携带哪个头访问我</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Headers'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span>
    <span class="token comment">// 允许哪个方法访问我</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Methods'</span><span class="token punctuation">,</span> <span class="token string">'PUT'</span><span class="token punctuation">)</span>
    <span class="token comment">// 允许携带cookie</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Credentials'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token comment">// 预检的存活时间</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Max-Age'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token comment">// 允许返回的头</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Expose-Headers'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// OPTIONS请求不做任何处理</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/getData'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'jw'</span><span class="token punctuation">)</span> <span class="token comment">//返回一个响应头，后台需设置</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'我不爱你'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getData'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'我不爱你'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>上述代码由http://localhost:3000/index.html向http://localhost:4000/跨域请求，正如我们上面所说的，后端是实现 CORS 通信的关键</p> <p>「与JSONP对比」</p> <p>JSONP只能实现GET请求，而CORS支持所有类型的HTTP请求。使用CORS，开发者可以使用普通的XMLHttpRequest发起请求和获得数据，比起JSONP有更好的错误处理。JSONP主要被老的浏览器支持，它们往往不支持CORS，而绝大多数现代浏览器都已经支持了CORS）</p> <p><strong>WebSocket协议跨域</strong></p> <p>Websocket是HTML5的一个持久化的协议，它实现了浏览器与服务器的全双工通信，同时也是跨域的一种解决方案</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>WebSocket和HTTP都是应用层协议，都基于 TCP 协议。但是 「WebSocket 是一种双向通信协议，在建立连接之后，WebSocket 的 server 与 client 都能主动向对方发送或接收数据」。同时，WebSocket 在建立连接时需要借助 HTTP 协议，连接建立好了之后 client 与 server 之间的双向通信就与 HTTP 无关了。</p></div> <p>本地文件socket.html向localhost:3000发生数据和接受数据</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// socket.html</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">let</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'我爱你'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//向服务器发送数据</span>
    <span class="token punctuation">}</span>
    socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//接收服务器返回的数据</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// server.js</span>
<span class="token keyword">let</span> WebSocket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ws'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//记得安装ws</span>
<span class="token keyword">let</span> wss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">{</span>port<span class="token operator">:</span><span class="token number">3000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
wss<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ws</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'我不爱你'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>nginx代理跨域</strong></p> <h2 id="_15、谈一谈你对xss攻击理解"><a href="#_15、谈一谈你对xss攻击理解" class="header-anchor">#</a> 15、谈一谈你对XSS攻击理解</h2> <p><code>XSS 攻击</code></p> <p>XSS是指黑客往 HTML 文件中或者 DOM 中注入恶意脚本，从而在用户浏览页面时利用注入的恶意脚本对用户实施攻击的一种手段</p> <ul><li>窃取Cookie</li> <li>监听用户行为，比如输入账号密码后之间发给黑客服务器</li> <li>在网页中生成浮窗广告</li> <li>修改DOM伪造登入表单</li></ul> <p><code>分类</code></p> <ul><li>存储型 XSS 攻击</li> <li>反射型 XSS 攻击</li> <li>基于 DOM 的 XSS 攻击</li></ul> <p><img src="/images/browser/xss.png" alt></p> <h4 id="存储型xss"><a href="#存储型xss" class="header-anchor">#</a> 存储型XSS</h4> <p>首先黑客利用站点漏洞将一段恶意 JavaScript 代码提交到网站的数据库中；然后用户向网站请求包含了恶意 JavaScript 脚本的页面；当用户浏览该页面的时候，恶意脚本就会将用户的 Cookie 信息等数据上传到服务器</p> <p>比如：在评论区提交一份脚本代码，假设前后端没有做好转义工作，那内容上传到服务器，在页面渲染的时候就会直接执行，相当于执行一段未知的JS代码。这就是存储型 XSS 攻击</p> <h4 id="反射型-xss-攻击"><a href="#反射型-xss-攻击" class="header-anchor">#</a> 反射型 XSS 攻击</h4> <p>反射型 XSS 攻击指的就是恶意脚本作为「网络请求的一部分」，随后网站又把恶意的JavaScript脚本返回给用户，当恶意 JavaScript 脚本在用户页面中被执行时，黑客就可以利用该脚本做一些恶意操作</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>TianTianUp<span class="token punctuation">.</span>com<span class="token operator">?</span>query<span class="token operator">=</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;你受到了XSS攻击&quot;</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如上，服务器拿到后解析参数query，最后将内容返回给浏览器，浏览器将这些内容作为HTML的一部分解析，发现是Javascript脚本，直接执行，这样子被XSS攻击了。
这也就是反射型名字的由来，将恶意脚本作为参数，通过网络请求，最后经过服务器，在反射到HTML文档中，执行解析</p> <p>主要注意的就是，「服务器不会存储这些恶意的脚本，这也算是和存储型XSS攻击的区别吧」。</p> <h4 id="基于-dom-的-xss-攻击"><a href="#基于-dom-的-xss-攻击" class="header-anchor">#</a> 基于 DOM 的 XSS 攻击</h4> <p>基于 DOM 的 XSS 攻击是不牵涉到页面 Web 服务器的。具体来讲，黑客通过各种手段将恶意脚本注入用户的页面中，在数据传输的时候劫持网络数据包</p> <p>常见的劫持手段有：</p> <ul><li>WIFI路由器劫持</li> <li>本地恶意软件</li></ul> <p><code>如何防范</code></p> <p>(1) 对用户输入的信息过滤或者是转码</p> <p>(2) 利用 CSP，服务器决定浏览器加载哪些资源</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>限制加载其他域下的资源文件，这样即使黑客插入了一个 JavaScript 文件，这个 JavaScript 文件也是无法被加载的；</p> <p>禁止向第三方域提交数据，这样用户数据也不会外泄</p> <p>提供上报机制，能帮助我们及时发现 XSS 攻击</p> <p>禁止执行内联脚本和未授权的脚本</p></div> <p>(3) 利用 HttpOnly</p> <p>由于很多 XSS 攻击都是来盗用 Cookie 的，因此还可以通过使用 HttpOnly 属性来保护我们 Cookie 的安全。这样子的话，JavaScript 便无法读取 Cookie 的值。这样也能很好的防范 XSS 攻击。</p> <p>通常服务器可以将某些 Cookie 设置为 HttpOnly 标志，HttpOnly 是服务器通过 HTTP 响应头来设置的，下面是打开 Google 时，HTTP 响应头中的一段</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>set<span class="token operator">-</span>cookie<span class="token operator">:</span> <span class="token constant">NID</span><span class="token operator">=</span><span class="token number">189</span><span class="token operator">=</span>M8l6<span class="token operator">-</span>z41asXtm2uEwcOC5oh9djkffOMhWqQrlnCtOI<span class="token punctuation">;</span> expires<span class="token operator">=</span>Sat<span class="token punctuation">,</span> <span class="token number">18</span><span class="token operator">-</span>Apr<span class="token operator">-</span><span class="token number">2020</span> <span class="token number">06</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">22</span> <span class="token constant">GMT</span><span class="token punctuation">;</span> path<span class="token operator">=</span><span class="token operator">/</span><span class="token punctuation">;</span> domain<span class="token operator">=</span><span class="token punctuation">.</span>google<span class="token punctuation">.</span>com<span class="token punctuation">;</span> HttpOnly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_16、csrf攻击"><a href="#_16、csrf攻击" class="header-anchor">#</a> 16、CSRF攻击</h2> <p>是指黑客引诱用户打开黑客的网站，在黑客的网站中，利用用户的登录状态发起的跨站请求</p> <p><code>防护策略</code></p> <p><strong>(1) 验证来源站点</strong></p> <p>在服务器端验证请求来源的站点，由于大量的CSRF攻击来自第三方站点，因此服务器跨域禁止来自第三方站点的请求，主要通过HTTP请求头中的两个Header</p> <ul><li>Origin Header</li> <li>Referer Header</li></ul> <p><strong>(2) 利用Cookie的SameSite属性</strong></p> <p>SameSite可以设置为三个值，<code>Strict</code>、<code>Lax</code>和<code>None</code></p> <ul><li>在Strict模式下，浏览器完全禁止第三方请求携带Cookie。比如请求sanyuan.com网站只能在sanyuan.com域名当中请求才能携带 Cookie，在其他网站请求都不能</li> <li>在Lax模式，就宽松一点了，但是只能在 get 方法提交表单况或者a 标签发送 get 请求的情况下可以携带 Cookie，其他情况均不能</li> <li>在None模式下，Cookie将在所有上下文中发送，即允许跨域发送</li></ul> <p><strong>(3) CSRF Token</strong></p> <p>前面讲到CSRF的另一个特征是，攻击者无法直接窃取到用户的信息（Cookie，Header，网站内容等），仅仅是冒用Cookie中的信息。</p> <p>那么我们可以使用Token，在不涉及XSS的前提下，一般黑客很难拿到Token</p> <p>Token步骤如下</p> <ul><li>将CSRF Token输出到页面中</li> <li>页面提交的请求携带这个Token</li> <li>服务器验证Token是否正确</li></ul> <h2 id="_17、304状态码"><a href="#_17、304状态码" class="header-anchor">#</a> 17、304状态码</h2> <ul><li><p>浏览器请求资源时首先命中资源的Expires 和 Cache-Control，Expires 受限于本地时间，如果修改了本地时间，可能会造成缓存失效，可以通过Cache-control: max-age指定最大生命周期，状态仍然返回200，但不会请求数据，在浏览器中能明显看到from cache字样。</p></li> <li><p>强缓存失效，进入协商缓存阶段，首先验证ETag。ETag可以保证每一个资源是唯一的，资源变化都会导致ETag变化。服务器根据客户端上送的If-None-Match值来判断是否命中缓存。</p></li> <li><p>协商缓存Last-Modify/If-Modify-Since阶段，客户端第一次请求资源时，服务服返回的header中会加上Last-Modify，Last-modify是一个时间标识该资源的最后修改时间。再次请求该资源时，request的请求头中会包含If-Modify-Since，该值为缓存之前返回的Last-Modify。服务器收到If-Modify-Since后，根据资源的最后修改时间判断是否命中缓存</p></li></ul> <h2 id="_18、chorme-打开一个-tab，会有多少个进程"><a href="#_18、chorme-打开一个-tab，会有多少个进程" class="header-anchor">#</a> 18、chorme 打开一个 tab，会有多少个进程</h2> <h4 id="进程与线程"><a href="#进程与线程" class="header-anchor">#</a> 进程与线程</h4> <p>一个进程就是一个程序的运行实例。当启动一个进程时，操作系统会为该进程创建一片内存，用于存储代码、运行中的数据、以及主线程，这样一个运行环境就叫做进程</p> <p>一个进程可以创建、管理多个线程，这些线程并行处理，提高运算效率</p> <p><strong>进程与线程之间的关系</strong></p> <ul><li>进程中任意一个线程出错，都会导致该进程的崩溃。</li> <li>一个进程之间的所有线程都共享该进程中数据。</li> <li>进程关闭时，操作系统会回收该进程所占用的内存。（因此在多进程浏览器中，页面死循环崩溃时，我们强行该页面就可以了）</li> <li>进程之间的内容时相互隔离的，一个进程崩溃，是不会影响其他进程的。</li></ul> <p><strong>单进程浏览器</strong></p> <p>单进程浏览器顾名思义，就是浏览器的所有功能模块都是在一个进程中的，包括网络、渲染引擎、js运行环境、插件等</p> <p><img src="/images/browser/single.png" alt></p> <p>单进程浏览器存在的问题有：</p> <ul><li><p>一个线程出错就会导致整个浏览器的崩溃。比如插件。除此之外，如果我们在js代码中不小心写了死循环，也会造成整个浏览器的崩溃。</p></li> <li><p>页面线程中需要执行的操作太多，如果js中有一段代码执行的时间比较长， 那么它就会阻塞之后的页面渲染和页面显示。</p></li> <li><p>进程的数据是共享的，那么就意味着我们可以利用浏览器的漏洞直接操作系统，这是不安全的。</p></li> <li><p>单进程浏览器还会因为内存泄漏造成整个浏览器的运行速度越来越慢。当一个页面比较复杂，当我们关闭这个页面，内存并没有被回收，只有当整个浏览器被关闭，也就是整个进程关闭时才会回收，所以内存占用会越来越高，浏览器运行越来越慢。</p></li></ul> <p><strong>多进程浏览器</strong></p> <p><code>早期的多进程浏览器</code></p> <p><img src="/images/browser/more-1.png" alt></p> <p>早期的浏览器的进程有：插件进程、渲染进程、浏览器主进程，如果所示。解决的单进程浏览器的问题：</p> <ul><li><p>进程之间相互隔离，因此一个进程的崩溃只会影响当前页面，并不会影响整个浏览器。</p></li> <li><p>插件进程、渲染进程都运行在沙箱中，因此即使像插件中如果存在恶意程序，那也不能操作系统。</p></li> <li><p>因为多进程的原因，所以浏览器不会越来越慢，因为当一个页面关闭时，渲染进程就会被关闭，内存被回收。</p></li></ul> <p><strong>现在的多进程浏览器</strong></p> <p><img src="/images/browser/more-2.png" alt></p> <p>现在浏览器的进程有：渲染进程、浏览器主进程、GPU进程、插件进程、网络进程。为了安全考虑，渲染进程、插件进程都是放在沙箱中运行的</p> <p><code>总结</code></p> <ul><li>浏览器主进程</li> <li>GPU 进程</li> <li>渲染进程</li> <li>Network 网络进程</li> <li>插件进程 (打开插件时才有)</li> <li>Storage service (当使用存储功能时才会开启该服务)</li></ul> <p>如果此时还打开了插件，每一类插件对应一个进程。</p> <hr> <p><strong>参考文章</strong></p> <p><a href="https://juejin.cn/post/6854573215830933512" target="_blank" rel="noopener noreferrer">「查缺补漏」送你18道浏览器面试题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.cn/post/6985027778135457822" target="_blank" rel="noopener noreferrer">chorme 打开一个 tab，会有多少个进程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.6c60143e.js" defer></script><script src="/assets/js/21.76e4f6fa.js" defer></script>
  </body>
</html>
