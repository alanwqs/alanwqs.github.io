<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TCP的可靠性传输是如何保证的 | 前端小时</title>
    <meta name="description" content="">
    <link rel="icon" href="/images/photo.jpg">
  <link rel="manifest" href="/images/photo.jpg">
  <link rel="apple-touch-icon" href="/images/photo.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.6aaa91c1.css" as="style"><link rel="preload" href="/assets/js/app.6c60143e.js" as="script"><link rel="preload" href="/assets/js/40.0ddc56cc.js" as="script"><link rel="prefetch" href="/assets/js/10.6b10a528.js"><link rel="prefetch" href="/assets/js/11.d7afebf9.js"><link rel="prefetch" href="/assets/js/12.f91b76fa.js"><link rel="prefetch" href="/assets/js/13.ee8d44a0.js"><link rel="prefetch" href="/assets/js/14.5fd9bab5.js"><link rel="prefetch" href="/assets/js/15.71185e7c.js"><link rel="prefetch" href="/assets/js/16.ae6001aa.js"><link rel="prefetch" href="/assets/js/17.79fc5361.js"><link rel="prefetch" href="/assets/js/18.42f30bb4.js"><link rel="prefetch" href="/assets/js/19.ef32d8a4.js"><link rel="prefetch" href="/assets/js/2.858e80da.js"><link rel="prefetch" href="/assets/js/20.5a98ceda.js"><link rel="prefetch" href="/assets/js/21.76e4f6fa.js"><link rel="prefetch" href="/assets/js/22.3f95dcd3.js"><link rel="prefetch" href="/assets/js/23.ba4d25bc.js"><link rel="prefetch" href="/assets/js/24.6a597996.js"><link rel="prefetch" href="/assets/js/25.227fb7ef.js"><link rel="prefetch" href="/assets/js/26.71946d04.js"><link rel="prefetch" href="/assets/js/27.db9dae04.js"><link rel="prefetch" href="/assets/js/28.ed68d8d4.js"><link rel="prefetch" href="/assets/js/29.63bc6416.js"><link rel="prefetch" href="/assets/js/3.3ede1f01.js"><link rel="prefetch" href="/assets/js/30.a9d05c1f.js"><link rel="prefetch" href="/assets/js/31.48f62c42.js"><link rel="prefetch" href="/assets/js/32.27c58484.js"><link rel="prefetch" href="/assets/js/33.f712075e.js"><link rel="prefetch" href="/assets/js/34.46e288c9.js"><link rel="prefetch" href="/assets/js/35.970c7f61.js"><link rel="prefetch" href="/assets/js/36.3644495c.js"><link rel="prefetch" href="/assets/js/37.0331be5a.js"><link rel="prefetch" href="/assets/js/38.64813422.js"><link rel="prefetch" href="/assets/js/39.f702b220.js"><link rel="prefetch" href="/assets/js/4.d3babcf5.js"><link rel="prefetch" href="/assets/js/41.46b314f4.js"><link rel="prefetch" href="/assets/js/42.7c392dca.js"><link rel="prefetch" href="/assets/js/43.87c578ae.js"><link rel="prefetch" href="/assets/js/44.4af6e740.js"><link rel="prefetch" href="/assets/js/45.e7e0dc1e.js"><link rel="prefetch" href="/assets/js/46.8cf9aafb.js"><link rel="prefetch" href="/assets/js/47.4fdbccab.js"><link rel="prefetch" href="/assets/js/48.17e8c14f.js"><link rel="prefetch" href="/assets/js/49.3fefb3c7.js"><link rel="prefetch" href="/assets/js/5.9485e149.js"><link rel="prefetch" href="/assets/js/50.eef5a0ce.js"><link rel="prefetch" href="/assets/js/51.d13fd75c.js"><link rel="prefetch" href="/assets/js/52.369ab3aa.js"><link rel="prefetch" href="/assets/js/53.cea9ac87.js"><link rel="prefetch" href="/assets/js/54.f9bc320e.js"><link rel="prefetch" href="/assets/js/55.7ab13cf8.js"><link rel="prefetch" href="/assets/js/56.16470a4a.js"><link rel="prefetch" href="/assets/js/57.d925d174.js"><link rel="prefetch" href="/assets/js/58.80cf022a.js"><link rel="prefetch" href="/assets/js/59.ec44b198.js"><link rel="prefetch" href="/assets/js/6.f5b22e2d.js"><link rel="prefetch" href="/assets/js/60.0880c9ba.js"><link rel="prefetch" href="/assets/js/61.991dc017.js"><link rel="prefetch" href="/assets/js/62.4ff6f265.js"><link rel="prefetch" href="/assets/js/63.02ad01a3.js"><link rel="prefetch" href="/assets/js/64.35e5afd7.js"><link rel="prefetch" href="/assets/js/65.f8b832c1.js"><link rel="prefetch" href="/assets/js/66.31422d32.js"><link rel="prefetch" href="/assets/js/67.b7251c18.js"><link rel="prefetch" href="/assets/js/68.0d2e42a1.js"><link rel="prefetch" href="/assets/js/69.34fe27a6.js"><link rel="prefetch" href="/assets/js/7.9bf19d03.js"><link rel="prefetch" href="/assets/js/8.f79eb03f.js"><link rel="prefetch" href="/assets/js/9.90611952.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6aaa91c1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端小时</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法题库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/leetcodeTop.html" class="nav-link">LeetCode TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/byte-dance.html" class="nav-link">字节 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/methods.html" class="nav-link">LeetCode 解题方法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/tencentTop100.html" class="nav-link">腾讯 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/aliTop100.html" class="nav-link">阿里 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/front-end.html" class="nav-link">前端手写代码</a></li><li class="dropdown-item"><!----> <a href="/algorithm/class.html" class="nav-link">跟着Carl学算法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/tencent.html" class="nav-link">腾讯精选练习 50 题</a></li><li class="dropdown-item"><!----> <a href="/algorithm/2020.html" class="nav-link">2020 名企高频面试题</a></li><li class="dropdown-item"><!----> <a href="/algorithm/middle.html" class="nav-link">中级算法</a></li></ul></div></div><div class="nav-item"><a href="http://blog.alanwu.website/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  旧版博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法题库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/leetcodeTop.html" class="nav-link">LeetCode TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/byte-dance.html" class="nav-link">字节 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/methods.html" class="nav-link">LeetCode 解题方法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/tencentTop100.html" class="nav-link">腾讯 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/aliTop100.html" class="nav-link">阿里 TOP 100</a></li><li class="dropdown-item"><!----> <a href="/algorithm/front-end.html" class="nav-link">前端手写代码</a></li><li class="dropdown-item"><!----> <a href="/algorithm/class.html" class="nav-link">跟着Carl学算法</a></li><li class="dropdown-item"><!----> <a href="/algorithm/tencent.html" class="nav-link">腾讯精选练习 50 题</a></li><li class="dropdown-item"><!----> <a href="/algorithm/2020.html" class="nav-link">2020 名企高频面试题</a></li><li class="dropdown-item"><!----> <a href="/algorithm/middle.html" class="nav-link">中级算法</a></li></ul></div></div><div class="nav-item"><a href="http://blog.alanwu.website/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  旧版博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>TCP的可靠性传输是如何保证的</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/http/http-safe.html#_01-前言" class="sidebar-link">01 前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/http/http-safe.html#_02-保证数据安全的方法" class="sidebar-link">02 保证数据安全的方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/http/http-safe.html#_03-小结" class="sidebar-link">03 小结</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>系统总结TCP连接中，它是如何保证数据的传输</p></div> <h2 id="_01-前言"><a href="#_01-前言" class="header-anchor">#</a> 01 前言</h2> <p>我们之前介绍过TCP的连接比UDP连接复杂，也比较安全，但是我们想知道它是如何保证这些数据的安全的？数据的发送先后有什么秘诀呢？接下来我就一一去总结这些细节性的问题。</p> <p><img src="howToEnsureTcp/1.png" alt></p> <h2 id="_02-保证数据安全的方法"><a href="#_02-保证数据安全的方法" class="header-anchor">#</a> 02 保证数据安全的方法</h2> <p>TCP主要提供了检验和、序列号/确认应答、超时重传、最大消息长度、滑动窗口控制等方法实现了可靠性传输。</p> <h5 id="检验和"><a href="#检验和" class="header-anchor">#</a> <strong>检验和</strong></h5> <p>通过检验和的方式，接收端可以检测出来数据是否有差错和异常，假如有差错就会直接丢弃TCP段，重新发送。TCP在计算检验和时，会在TCP首部加上一个12字节的伪首部。检验和总共计算3部分：TCP首部、TCP数据、TCP伪首部</p> <p><img src="howToEnsureTcp/2.png" alt></p> <h5 id="序列号-确认应答"><a href="#序列号-确认应答" class="header-anchor">#</a> <strong>序列号/确认应答</strong></h5> <p>这个机制类似于问答的形式。比如在课堂上老师会问你“明白了吗？”，假如你没有隔一段时间没有回应或者你说不明白，那么老师就会重新讲一遍。其实计算机的确认应答机制也是一样的，发送端发送信息给接收端，接收端会回应一个包，这个包就是应答包。</p> <p><img src="howToEnsureTcp/3.png" alt></p> <p>上述过程中，只要发送端有一个包传输，接收端没有回应确认包（ACK包），都会重发。或者接收端的应答包，发送端没有收到也会重发数据。这就可以保证数据的完整性。</p> <h5 id="超时重传"><a href="#超时重传" class="header-anchor">#</a> <strong>超时重传</strong></h5> <p>超时重传是指发送出去的数据包到接收到确认包之间的时间，如果超过了这个时间会被认为是丢包了，需要重传。那么我们该如何确认这个时间值呢？</p> <p>我们知道，一来一回的时间总是差不多的，都会有一个类似于平均值的概念。比如发送一个包到接收端收到这个包一共是0.5s，然后接收端回发一个确认包给发送端也要0.5s，这样的两个时间就是RTT（往返时间）。然后可能由于网络原因的问题，时间会有偏差，称为抖动（方差）。</p> <p>从上面的介绍来看，超时重传的时间大概是比往返时间+抖动值还要稍大的时间。</p> <p><img src="howToEnsureTcp/4.png" alt></p> <p>但是在重发的过程中，假如一个包经过多次的重发也没有收到对端的确认包，那么就会认为接收端异常，强制关闭连接。并且通知应用通信异常强行终止。</p> <h5 id="最大消息长度"><a href="#最大消息长度" class="header-anchor">#</a> <strong>最大消息长度</strong></h5> <p>在建立TCP连接的时候，双方约定一个最大的长度（MSS）作为发送的单位，重传的时候也是以这个单位来进行重传。理想的情况下是该长度的数据刚好不被网络层分块。</p> <p><img src="howToEnsureTcp/5.png" alt></p> <h5 id="滑动窗口控制"><a href="#滑动窗口控制" class="header-anchor">#</a> <strong>滑动窗口控制</strong></h5> <p>我们上面提到的超时重传的机制存在效率低下的问题，发送一个包到发送下一个包要经过一段时间才可以。所以我们就想着能不能不用等待确认包就发送下一个数据包呢？这就提出了一个滑动窗口的概念。</p> <p><img src="howToEnsureTcp/6.png" alt></p> <p>窗口的大小就是在无需等待确认包的情况下，发送端还能发送的最大数据量。这个机制的实现就是使用了大量的缓冲区，通过对多个段进行确认应答的功能。通过下一次的确认包可以判断接收端是否已经接收到了数据，如果已经接收了就从缓冲区里面删除数据。</p> <p>在窗口之外的数据就是还未发送的和对端已经收到的数据。那么发送端是怎么样判断接收端有没有接收到数据呢？或者怎么知道需要重发的数据有哪些呢？通过下面这个图就知道了。</p> <p><img src="howToEnsureTcp/7.png" alt></p> <p>如上图，接收端在没有收到自己所期望的序列号数据之前，会对之前的数据进行重复确认。发送端在收到某个应答包之后，又连续3次收到同样的应答包，则数据已经丢失了，需要重发。</p> <h5 id="拥塞控制"><a href="#拥塞控制" class="header-anchor">#</a> <strong>拥塞控制</strong></h5> <p>窗口控制解决了 两台主机之间因传送速率而可能引起的丢包问题，在一方面保证了TCP数据传送的可靠性。然而如果网络非常拥堵，此时再发送数据就会加重网络负担，那么发送的数据段很可能超过了最大生存时间也没有到达接收方，就会产生丢包问题。为此TCP引入慢启动机制，先发出少量数据，就像探路一样，先摸清当前的网络拥堵状态后，再决定按照多大的速度传送数据。</p> <p>此处引入一个拥塞窗口：</p> <p>发送开始时定义拥塞窗口大小为1；每次收到一个ACK应答，拥塞窗口加1；而在每次发送数据时，发送窗口取拥塞窗口与接送段接收窗口最小者。</p> <p>慢启动：在启动初期以指数增长方式增长；设置一个慢启动的阈值，当以指数增长达到阈值时就停止指数增长，按照线性增长方式增加至拥塞窗口；线性增长达到网络拥塞时立即把拥塞窗口置回1，进行新一轮的“慢启动”，同时新一轮的阈值变为原来的一半。</p> <p><img src="howToEnsureTcp/8.png" alt></p> <h2 id="_03-小结"><a href="#_03-小结" class="header-anchor">#</a> 03 小结</h2> <p>其实上面所说的知识在学校也学过，但是重来不会认真对待这些看似没有用的知识，所以现在就好好总结一下了。对于网络优化的部分可以参照上面的方法来进行优化，可以利用这些方法提供高速、可靠的通信服务。</p> <p><strong><font color="green">参考文章</font></strong></p> <ul><li>图解TCP/IP</li> <li>TCP是如何保证数据的传输</li></ul> <p><img src="howToEnsureTcp/2.gif" alt></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.6c60143e.js" defer></script><script src="/assets/js/40.0ddc56cc.js" defer></script>
  </body>
</html>
